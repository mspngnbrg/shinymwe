---
title: "Start/publish apps on shiny.io"
output: html_notebook
---

```{r}
dropbox <- FALSE

# App folder names (do NOT change!)
folder_names <- c("../01_collect_questions", "../02_question_curation", 
                  "../03_start_quiz", "../04_show_results")

# 1. CONNECT TO DROPBOX
# =====================
# Skip to 2. if you want to test locally
dropbox <- TRUE # only if you have DROPBOX access!
# to be on the safe side, delete .httr-oauth file in 00_setup_readme folder
drop_auth_file <- ".httr-oauth" # dropbox authentication key
if(file.exists(drop_auth_file ))file.remove(drop_auth_file )

library(rdrop2)
drop_auth() # opens website for dropbox PW 

for(INDEX in 1:length(folder_names)) {
  file.copy(list.files(getwd(), ".httr-oauth", all.files = TRUE), 
            folder_names[INDEX], overwrite = TRUE)
}

# 2. Folder names
# ================
# here student Q&As, a teacher summary and quiz answers are stored

d <- data.frame(questions_raw = "05_questions_1",
                questions_teacher = "05_teacher_1",
                answers_raw = "05_answers_1",
                dropbox = dropbox) # use DROPBOX or save files locally
saveRDS(d, "folder_names.rds")

# copy d into each app folder
for(INDEX in 1:length(folder_names)) {
  temp_folder_name <- paste0(folder_names[INDEX], "/data")
  if(!dir.exists(temp_folder_name)) dir.create(temp_folder_name)
file.copy(list.files(getwd(), "folder_names.rds", all.files = TRUE), temp_folder_name , overwrite = TRUE) 
}

# 3. launch app:
# ==============
# If you want to upload apps to shinyapps.io, uncomment one line and run it
# If you want to test locally, go to app folders (01_ ... etc), open app.R and click "Run app" on top of script

# rsconnect::deployApp('../01_collect_questions/', account = "mspangenberg")
# rsconnect::deployApp('../02_question_curation/', account = "mspangenberg")
# rsconnect::deployApp('../03_start_quiz/', account = "mspangenberg")
# rsconnect::deployApp('../04_show_results/', account = "mspangenberg")

# IF APPS WERE DELETED ON SHINYAPPS.IO MANUALLY:

#Preparing to deploy application...Error: HTTP 404
#GET https://api.shinyapps.io/v1/applications/5962207
#Not Found

# rsconnect::forgetDeployment("../01_collect_questions")
# rsconnect::forgetDeployment("../02_question_curation")
# rsconnect::forgetDeployment("../03_start_quiz")
# rsconnect::forgetDeployment("../04_show_results")
```

